<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">

        <title>Loan Application Results</title>
        <script src="https://d3js.org/d3.v3.min.js"></script>
    	<script src="https://cdn.jsdelivr.net/jstat/latest/jstat.min.js"></script>	    
        <script src="http://d3js.org/colorbrewer.v1.min.js"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <style>
            text{
                font-family: sans-serif;
                font-size: 12px;
                text-anchor: left;
            }
            .axis path,
            .axis line {
                fill: none;
                stroke: #000;
                shape-rendering: crispEdges;
            }
            /*.x.axis path {
                display: none;
            }*/
            .line {
                fill: none;
                stroke: steelblue;
                stroke-width: 1.5px;
            }
            .states {
                stroke: #fff;
                stroke-width:0.5px;
            }
            div.tooltip {	
                position: absolute;			
                text-align: center;			
                width: 130px;					
                height: 15px;					
                padding: 2px;				
                font: 12px sans-serif;	
                background: rgb(221, 221, 221);	
                border: 0px;		
                border-radius: 8px;			
                pointer-events: none;			
            }
		</style>
    </head>
    <div id="intro"></div>
    <div class="pagebreak"> </div>
    <div id="approval"></div>
    <div class="pagebreak"> </div>
    <div id="summary"></div>
    <div class="pagebreak"> </div>
    <div id="stats"></div> 
    <div class="pagebreak"> </div>
    <div id="chloro"></div> 
    <body>
        <script type="text/javascript">
	var intViewportWidth = window.innerWidth*0.9;

    var margin = 50,
            Credit_Score = {{data.Credit_Score|tojson}},
            interest = {{data.interest|tojson}},
            loan_amt = {{data.loan_amnt|tojson}},
            term = {{data.term|tojson}},
            approval = {{data.approval|tojson}},
            emp_length = {{data.emp_length|tojson}},
            annual_inc = {{data.annual_inc|tojson}},
            zip_code = {{data.zip_code|tojson}},
            debt = {{data.debt|tojson}},
            dti = {{data.dti|tojson}},
            delinq_2yrs = {{data.delinq_2yrs|tojson}},
            inq_last_6mths = {{data.inq_last_6mths|tojson}},
            mths_since_last_delinq = {{data.mths_since_last_delinq|tojson}},
            open_acc = {{data.open_acc|tojson}},
            total_acc = {{data.total_acc|tojson}},
            revol_bal = {{data.revol_bal|tojson}},
            cred_hist_mth = {{data.cred_hist_mth|tojson}},
            revol_bal_to_annual_inc = {{data.revol_bal_to_annual_inc|tojson}},
			
            alt1_amt = {{data.alt1_amt|tojson}},
            alt1_term = '36 months',
            alt1_int = {{data.alt1_rate|tojson}},
			
            alt2_amt = {{data.alt2_amt|tojson}},
            alt2_term = "60 months",
            alt2_int ={{data.alt2_rate|tojson}}
            ;

//----------------INTRO------------------------------------------

        var intro_height = 50,
            intro_width = intViewportWidth;

        var svg = d3.select("#intro").append("svg")
            .attr("width", intro_width + margin)
            .attr("height", intro_height);

        svg.append("rect")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("fill", "steelblue");

        svg.append("g")
            .attr("transform", "translate(" + margin + "," + margin + ")");

        svg.append("text")
            .attr("class", "title")
            .attr("x",(intro_width+margin)/2-4)
            .attr("y",30)
            .style("text-anchor","middle")
            .style("font-weight","bold")
            .style("font-size","20px")
            .attr("fill","white")
            .text("Loan Application Results");

//----------------LOAN SUMMARY------------------------------------------

        var summary_height = 100,
            summary_width = intViewportWidth;

        var svg2 = d3.select("#summary").append("svg")
            .attr("width", summary_width + margin)
            .attr("height", summary_height + margin)
            .append("g")
            .attr("transform", "translate(" + margin + "," + margin + ")");    

        svg2.append("text")
            .attr("class", "title")
            .attr("x",(summary_width+margin)/2-margin)
            .attr("y",-margin+27)
            .style("text-anchor","middle")
            .style("font-weight","bold")
            .style("font-size","18px")
            .text("Application Summary");

        svg2.append("line")
            .style("stroke", "grey")
            .style("stroke-width", "2px")
            .attr("x1", -margin)
            .attr("y1", -margin+2)
            .attr("x2", summary_width+margin)
            .attr("y2", -margin+2);

//FIRST COLUMN
        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10)
            .attr("y",-margin+60)
            .text("Loan Amount:");

        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10)
            .attr("y",-margin+80)
            .text("Term:");

        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10)
            .attr("y",-margin+100)
            .text("Employment Legnth:");

        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10)
            .attr("y",-margin+120)
            .text("Zip Code:");

    //INSERT VALUES
        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10 + 150)
            .attr("y",-margin+60)
            .text("$"+loan_amt);

        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10 + 150)
            .attr("y",-margin+80)
            .text(term + " mo");

        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10 + 150)
            .attr("y",-margin+100)
            .text(emp_length + " yrs");

        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10 + 150)
            .attr("y",-margin+120)
            .text(zip_code);

//SECOND COLUMN
        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10*3)
            .attr("y",-margin+60)
            .text("Annual Income:");

        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10*3)
            .attr("y",-margin+80)
            .text("Debt - Income Ratio:");

        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10*3)
            .attr("y",-margin+100)
            .text("Revolving Balance:");

        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10*3)
            .attr("y",-margin+120)
            .text("Revolving Bal. - Income Ratio:");

    //INSERT VALUES
        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10*3+200)
            .attr("y",-margin+60)
            .text("$"+annual_inc);

        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10*3+200)
            .attr("y",-margin+80)
            .text(dti);

        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10*3+200)
            .attr("y",-margin+100)
            .text("$"+revol_bal);

        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10*3+200)
            .attr("y",-margin+120)
            .text(revol_bal_to_annual_inc);

//THIRD COLUMN
        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10*5)
            .attr("y",-margin+60)
            .text("# Total Accounts:");

        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10*5)
            .attr("y",-margin+80)
            .text("# Open Accounts:");

        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10*5)
            .attr("y",-margin+100)
            .text("# Deliquencies in Last 2 Years:");

        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10*5)
            .attr("y",-margin+120)
            .text("# Months Since Delinquency:");

    //INSERT VALUES
        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10*5+200)
            .attr("y",-margin+60)
            .text(total_acc);

        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10*5+200)
            .attr("y",-margin+80)
            .text(open_acc);

        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10*5+200)
            .attr("y",-margin+100)
            .text(delinq_2yrs);

        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10*5+200)
            .attr("y",-margin+120)
            .text(mths_since_last_delinq);

//LAST COLUMN
        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10*7)
            .attr("y",-margin+60)
            .text("# Months of Credit History:");

        svg2.append("text")
            .attr("class", "subtitle")
            .attr("x",innerWidth/10*7)
            .attr("y",-margin+80)
            .text("# Inquiries in Last 6 Months:");
    
    //INSERT VALUES
        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10*7+ 150)
            .attr("y",-margin+60)
            .text(cred_hist_mth);

        svg2.append("text")
            .attr("class", "value")
            .attr("x",innerWidth/10*7+150)
            .attr("y",-margin+80)
            .text(inq_last_6mths);



//----------------LOAN APPROVAL------------------------------------------
            
        if (approval == "true") {

            var approval_height = 70,
                approval_width = intViewportWidth;

            var ap_mid = (approval_width+margin)/2-margin

            var svg3 = d3.select("#approval").append("svg")
                .attr("width", approval_width + margin)
                .attr("height", approval_height + margin)
                .append("g")
                .attr("transform", "translate(" + margin + "," + margin + ")");  

            svg3.append("text")
                .attr("class", "title")
                .attr("x",ap_mid)
                .attr("y",-margin+25)
                .style("text-anchor","middle")
                .style("font-weight","bold")
                .style("font-size","18px")
                .text("Approval");

            svg3.append("line")
                .style("stroke", "grey")
                .style("stroke-width", "2px")
                .attr("x1", -margin)
                .attr("y1", -margin+2)
                .attr("x2", approval_width+margin*2)
                .attr("y2", -margin+2);

        //LOAN APPROVAL
            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",intViewportWidth/2 - 200)
                .attr("y",-margin+60)
                .style("font-size","15px")
                .text("Is Loan Likely To Be Approved:");

            svg3.append("text")
                .attr("class", "value")
                .attr("x",intViewportWidth/2+ 100)
                .attr("y",-margin+60)
                .style("font-size","30px")
                .attr('fill','green')
                .text( "Yes");

     //INTEREST RATE
            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",intViewportWidth/2 - 200)
                .attr("y",-margin+90)
                .style("font-size","15px")
                .text("Likely Interest Rate:");

            svg3.append("text")
                .attr("class", "value")
                .attr("x",intViewportWidth/2+ 100)
                .attr("y",-margin+90)
                .style("font-size","30px")
                .text(interest+"%");
        ;}
        
        else {

            var approval_height = 120,
                approval_width = 800;

            var ap_mid = (approval_width+margin)/2-margin

            var svg3 = d3.select("#approval").append("svg")
                .attr("width", approval_width + margin)
                .attr("height", approval_height + margin)
                .append("g")
                .attr("transform", "translate(" + margin + "," + margin + ")");  

            svg3.append("text")
                .attr("class", "title")
                .attr("x",ap_mid)
                .attr("y",-margin+25)
                .style("text-anchor","middle")
                .style("font-weight","bold")
                .style("font-size","18px")
                .text("Approval");

            svg3.append("line")
                .style("stroke", "grey")
                .style("stroke-width", "2px")
                .attr("x1", -margin)
                .attr("y1", -margin+2)
                .attr("x2", approval_width+margin*2)
                .attr("y2", -margin+2);

        //LOAN APPROVAL - NO
            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",240)
                .attr("y",-margin+58)
                .style("font-size","15px")
                .text("Is Loan Likely To Be Approved:");

            svg3.append("text")
                .attr("class", "value")
                .attr("x",450)
                .attr("y",-margin+58)
                .style("font-size","30px")
                .attr('fill','red')
                .text("No");    
    
        //ALTERNATE 1
            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",140)
                .attr("y",-margin+90)
                .style("font-size","13px")
                .style("text-decoration", "underline") 
                .text("Alternate Loan 1");
            
            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",140)
                .attr("y",-margin+110)
                .text("Loan Amount");

            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",140)
                .attr("y",-margin+130)
                .text("Term");

            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",140)
                .attr("y",-margin+150)
                .text("Likely Interest Rate");

        //INSERT VALUES
            svg3.append("text")
                .attr("class", "value")
                .attr("x",280)
                .attr("y",-margin+110)
                .text("$"+alt1_amt);

            svg3.append("text")
                .attr("class", "value")
                .attr("x",280)
                .attr("y",-margin+130)
                .text(alt1_term);

            svg3.append("text")
                .attr("class", "value")
                .attr("x",280)
                .attr("y",-margin+150)
                .text(alt1_int+"%");

        //ALTERNATE 2
            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",430)
                .attr("y",-margin+90)
                .style("font-size","13px")
                .style("text-decoration", "underline") 
                .text("Alternate Loan 2");

            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",430)
                .attr("y",-margin+110)
                .text("Loan Amount");

            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",430)
                .attr("y",-margin+130)
                .text("Term");

            svg3.append("text")
                .attr("class", "subtitle")
                .attr("x",430)
                .attr("y",-margin+150)
                .text("Likely Interest Rate");

        //INSERT VALUES
            svg3.append("text")
                .attr("class", "value")
                .attr("x",550)
                .attr("y",-margin+110)
                .text("$"+alt2_amt);

            svg3.append("text")
                .attr("class", "value")
                .attr("x",550)
                .attr("y",-margin+130)
                .text(alt2_term);

            svg3.append("text")
                .attr("class", "value")
                .attr("x",550)
                .attr("y",-margin+150)
                .text(alt2_int+"%");
        }

//----------------KEY STATISTICS------------------------------------------

        var stats_height = 300,
            stats_width = intViewportWidth;

        var gauge_width = intViewportWidth/2,
            gauge_height     = 400, 
            gauge_margin     = 70,
            n          = 30,
            radius     = gauge_width/2 - (gauge_margin*2),
            needleRad  = 10,
            pi         = Math.PI,
            halfPi     = pi/2,
            endAngle   = pi/2,
            startAngle = -endAngle,
            data       = d3.range(startAngle, endAngle, pi/n),
            _data      = data.slice(0),
            tt         = 3000,
            gauge_scale      = d3.scale.linear().range([startAngle, endAngle]).domain([300,850]),
            gauge_colorScale = d3.scale.quantize().range(colorbrewer.RdYlGn[6]).domain([data[0], data[data.length-1]]),
            gauge_scoreScale = d3.scale.linear().domain([startAngle, endAngle]).range([300,850]);

        var svg4 = d3.select("#stats").append("svg")
            .attr("width", stats_width+margin)
            .attr("height", stats_height+margin)
            .append("g")
            .attr("transform", "translate(" + 180 + "," + 200 + ")");  
        
        svg4.append("text")
            .attr("class", "title")
            .attr("x",(stats_width+margin)/2-margin-130)
            .attr("y",-200+27)
            .style("text-anchor","middle")
            .style("font-weight","bold")
            .style("font-size","18px")
            .text("Key Statistics");

        svg4.append("line")
            .style("stroke", "grey")
            .style("stroke-width", "2px")
            .attr("x1", -200)
            .attr("y1", -198)
            .attr("x2", stats_width+margin*2)
            .attr("y2", -198);

        _data.push(endAngle);

        var arc = d3.svg.arc()
            .innerRadius(radius - (radius/5))
            .outerRadius(radius)
            .startAngle(function(d) { return d; })
            .endAngle(function(d, i) { return _data[i + 1]; });

        var slice = svg4.append('g').selectAll('path.slice').data(data);

        slice
            .enter()
            .append('path')
            .attr('class', 'slice')
            .attr('d', arc)
            .attr("transform", "translate(" + 40 + "," + 70 + ")")
            .attr('fill', function(d) { return gauge_colorScale(d); });

        var needle = svg4.append('g').append('path')
            .attr('class', 'needle')
            .attr('fill-opacity', .7)
            .attr('stroke', 'black')
            .attr("transform", "translate(" + 40 + "," + 70 + ")");

        var text = svg4.append('g').append('text')
            .attr('class', 'text')
            .attr('text-anchor', 'middle')
            .attr('font-weight','bold')
            .attr('font-size','14px')
            .attr('dx', '3.2em')
            .attr('dy', '6em');

        svg4.append("text")
                .attr("class", "subtitle")
                .attr("x",40)
                .attr("y",-150)
                .style("text-anchor","middle")
                .style("text-decoration", "underline") 
                .style("font-size","14px")
                .text("Applicant Score");

        function update(oldValue, newValue){
            needle
                .datum({ oldValue: oldValue })
                .transition().duration(tt)
                .attrTween('d', lineTween(newValue))
                ;

            text
                .datum({ oldValue: oldValue })
                .transition().duration(tt)
                .attrTween('transform', transformTween(newValue))
                .tween('text', textTween(newValue));
        }

        function textTween(newValue){
            return function(d){

                var that = d3.select(this),
                    i    = d3.interpolate(d.oldValue, newValue);

                return function(t){
                    that.text(d3.format('.0f')(gauge_scoreScale(i(t))));
                };
            };
        }

        function transformTween(newValue){
            return function(d){

                var interpolate = d3.interpolate(d.oldValue, newValue);

                return function(t){
                    var _in     = interpolate(t) - halfPi,
                        centerX = (radius + 20) * Math.cos(_in),
                        centerY = (radius + 20) * Math.sin(_in);
                    return 'translate(' + centerX + ',' + centerY + ')';
                };
            };
        }

        function lineTween(newValue){
            return function(d){

                var interpolate = d3.interpolate(d.oldValue, newValue);

                return function(t){

                    var _in = interpolate(t) - halfPi,
                        _im = _in - halfPi,
                        _ip = _in + halfPi;

                    var topX = radius * Math.cos(_in),
                        topY = radius * Math.sin(_in);

                    var leftX = needleRad * Math.cos(_im),
                        leftY = needleRad * Math.sin(_im);

                    var rightX = needleRad * Math.cos(_ip),
                        rightY = needleRad * Math.sin(_ip);

                    return d3.svg.line()([[topX, topY], [leftX, leftY], [rightX, rightY]]) + 'Z';
                };
            };
        }

    // RUN CREDIT SCORE NEEDLE
        update(gauge_scale(300), gauge_scale(Credit_Score));



 //----------------BELL CURVE----------------------------------
        var intViewportWidth = window.innerWidth*0.9;

        var width = intViewportWidth/2 - 2*margin,
            height = 300 - 2*margin;
	
        var array1 = Random_normal_Dist(76148.4372, 70134.9299);
	
        var x = d3.scale.linear()
            .range([0, width]);

        var y = d3.scale.linear()
            .range([height, 0]);

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom");

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left");

        var line = d3.svg.line()
        .x(function (d) { return x(d.q); })
        .y(function (d) { return y(d.p); });

        //Min q
	var min_d = d3.min(array1, function (d) { return d.q; });
	//Max q
        var max_d = d3.max(array1, function (d) { return d.q; });
        //Max p
        max_p = d3.max(array1, function (d) { return d.p; });

        x.domain([min_d, max_d]).nice;

        y.domain([0, max_p])

        svg4.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate("+ 450 +"," + 90 + ")")
            .call(xAxis);

        svg4.append("g")
            .attr("class", "y axis")
            .attr("transform", "translate("+ 450 +"," + -110 + ")")
            .call(yAxis);

        svg4.append("path")
        .datum(array1)
        .attr("class", "line")
        .attr("d", line)
        .attr("transform", "translate("+ 450 +"," + -110 + ")")
        .style("fill", "#fdae61")
        .style("opacity", "0.5");

        svg4.append("text")
            .attr("class", "subtitle")
            .attr("x",750)
            .attr("y",-150)
            .style("text-anchor","middle")
            .style("text-decoration", "underline")
            .style("font-size","14px")
            .text("Income Distribution");

        function Random_normal_Dist(mean, sd) {
          dataset = [];
          for (var i = mean - 4 * sd; i < mean + 4 * sd; i += 1) {
              q = i
              p = jStat.normal.pdf(i, mean, sd);
              arr = {
                "q": q,
                "p": p
            }
            dataset.push(arr);
          };
          return dataset;
  };

//----------------CHLORO------------------------------------------

        var chloro_height = 500,
            chloro_width = intViewportWidth;

        var svg5 = d3.select("#chloro").append("svg")
            .attr("width", chloro_width)
            .attr("height", chloro_height)
            .append("g")
            .attr("transform", "translate(" + 275 + "," + 150 + ")"); 

      /*  var chColorScale = d3.scale.quantize()
                    .domain([0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.10,0.11])
                    .range(colorbrewer.Blues[9]);   */
        
        var projection = d3.geo.albersUsa()
            .scale(1000)
            .translate([400, 120]);
        
        var path = d3.geo.path()
            .projection(projection);

        var div = d3.select("body").append("div")	
            .attr("class", "tooltip")				
            .style("opacity", 0);
        
        var data = {
            Name: ["Alabama","Alaska","Arizona","Arkansas","California","Colroado","Connecticut","Delaware","D.C.","Florida","Georgia","Hawaii",
"Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri",
"Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania",
"Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],
            Avg: [0.049464326,0.074700234,0.079149595,0.052298621,0.083716324,0.088168134,0.090524551,0.060580358,0.065755933,0.060584255,0.087601078,0.060510054,
0.047093748,0.078933954,0.063721808,0.023554604,0.072304863,0.055556305,0.054204475,0.053352066,0.079174318,0.081878239,0.068157742,0.093748266,
0.040664469,0.063912605,0.076668741,0.05995,0.084405478,0.081731633,0.084082063,0.063293647,0.081179148,0.0637693,0.063484571,0.06519812,0.059389022,
0.081725911,0.064913864,0.077801623,0.053220671,0.069491692,0.054481824,0.065467093,0.072959134,0.082641536,0.074240174,0.081800308,
0.069228073,0.071948594,0.082248761,],
            StateID: ['AL','AK','AZ','AR','CA','CO','CT','DE','DC','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN',
'MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY',] 
        }

        var nums = {
            BinNames: ["$0-$4,999","$5,000-$9,999","$10,000-$14,999","$15,000-$19,999","$20,000-$24,999","$25,000-$29,999","$30,000-$34,999","$35,000-$39,999","$40,000-$44,999","$45,000-$49,999","$50,000-$54,999","$55,000-$59,999","$60,000-$64,999","$65,000-$69,999","$70,000-$74,999","$75,000+"],
            Bins:  [4999,9999,14999,19999,24999,29999,34999,39999,44999,49999,54999,59999,64999,69999,74999,10000000000000000000000000],
            AL:    [0.017896053,0.050787312,0.066926208,0.092617877,0.078530779,0.068067573,0.063624034,0.045018384,0.022036304,0,0,0,0,0,0,0,0],
            AK:    [0.020429389,0.068996711,0.085932316,0.136130685,0.119710725,0.110933759,0.089354839,0.064907427,0.036071429,0,0,0,0,0,0,0,0],
            AZ:    [0.034397277,0.082933838,0.098817944,0.126460941,0.106108511,0.093291304,0.085708173,0.067064236,0.040977191,0,0,0,0,0,0,0,0],
            AR:    [0.024584142,0.05593787,0.068290895,0.084240688,0.06856909,0.059661504,0.050237551,0.03722327,0.023289316,0,0,0,0,0,0,0,0],
            CA:    [0.034782309,0.085961563,0.100709971,0.135240366,0.121247623,0.106546113,0.095395084,0.071370463,0.04089749,0,0,0,0,0,0,0,0],
            CO:    [0.03902593,0.086752866,0.10789503,0.140532631,0.122068475,0.112124282,0.094320087,0.075747308,0.041964887,0,0,0,0,0,0,0,0],
            CT:    [0.044491103,0.089089052,0.103448744,0.135909163,0.12730685,0.109523572,0.099677478,0.081566985,0.045853498,0,0,0,0,0,0,0,0],
            DE:    [0.022239234,0.060442502,0.076205962,0.108673411,0.091917201,0.08612741,0.073774906,0.059287647,0.027690151,0,0,0,0,0,0,0,0],
            FL:    [0.028537236,0.072346653,0.081798786,0.10595742,0.085540057,0.075600532,0.068668521,0.050289784,0.031823116,0,0,0,0,0,0,0,0],
            GA:    [0.020211363,0.062457675,0.078024781,0.105317911,0.092903041,0.081613377,0.077361871,0.05864684,0.029931503,0,0,0,0,0,0,0,0],
            HI:    [0.026877993,0.075761066,0.104544568,0.077943711,0.072362026,0.06696081,0.045481098,0.02294214,0,0.060589486,0,0,0,0,0,0],
            ID:    [0.022436373,0.051841058,0.053568353,0.074361964,0.063794068,0.055653488,0.056212073,0.046120287,0.024710666,0,0,0,0,0,0,0,0],
            IL:    [0.031160731,0.079362555,0.095628269,0.125983658,0.115611569,0.101134265,0.09320123,0.072351191,0.04439515,0,0,0,0,0,0,0,0],
            IN:    [0.024876564,0.066056756,0.081820731,0.108205556,0.090246183,0.082390892,0.072944828,0.051904821,0.031892226,0,0,0,0,0,0,0,0],
            IA:    [0.025641026,0.011235955,0.0625,0.0625,0.087152856,0.011262125,0.04245935,0.051229344,0.004376226,0.037037037,0,0,0,0,0,0],
            KS:    [0.029334813,0.073891626,0.09397033,0.119917501,0.105361219,0.089650086,0.084554072,0.057430811,0.035767071,0,0,0,0,0,0,0,0],
            KY:    [0.023319384,0.060343054,0.070951977,0.095860438,0.078781881,0.066901991,0.06199985,0.042626105,0.026181976,0,0,0,0,0,0,0,0],
            LA:    [0.019987932,0.057647693,0.073569663,0.103010966,0.081843683,0.075836746,0.065359071,0.044475075,0.02324384,0,0,0,0,0,0,0,0],
            ME:    [0.025720285,0.058534102,0.060745539,0.081847553,0.067664364,0.055028463,0.05840708,0.045943041,0.028056112,0,0,0,0,0,0,0,0],
            MD:    [0.029318037,0.075301673,0.09570729,0.134873159,0.122827264,0.111764706,0.10765625,0.082865829,0.050944738,0,0,0,0,0,0,0,0],
            MA:    [0.010146686,0.084684839,0.104349101,0.13540869,0.111262912,0.108614232,0.093859357,0.070045397,0.035912666,0,0,0,0,0,0,0,0],
            MI:    [0.031194705,0.070578531,0.084531471,0.108636751,0.093997168,0.084722403,0.072761513,0.054613168,0.032040085,0,0,0,0,0,0,0,0],
            MN:    [0.043085437,0.096264235,0.116894499,0.149084984,0.127269753,0.110371409,0.093774678,0.070384517,0.03983481,0,0,0,0,0,0,0,0],
            MS:    [0.013725365,0.044084764,0.055008827,0.081419807,0.06406536,0.058591594,0.057025152,0.039285714,0.02240099,0,0,0,0,0,0,0,0],
            MO:    [0.025083519,0.068482742,0.083251206,0.108277506,0.092503582,0.080716954,0.073984135,0.053893241,0.03420342,0,0,0,0,0,0,0,0],
            MT:    [0.041080186,0.089020772,0.09898167,0.111902715,0.092305619,0.075039317,0.061809495,0.039972112,0.025597986,0,0,0,0,0,0,0,0],
            NE:    [0.02995278,0.061969795,0.07423785,0.097544221,0.077349651,0.065956716,0.06399642,0.047061121,0.029965526,0,0,0,0,0,0,0,0],
            NV:    [0.036720463,0.087734201,0.106399569,0.13582137,0.116681483,0.10507974,0.092022661,0.065626911,0.03946172,0,0,0,0,0,0,0,0],
            NH:    [0.040547877,0.081783183,0.096791383,0.120604497,0.105867448,0.097381458,0.081424481,0.063746813,0.035845107,0,0,0,0,0,0,0,0],
            NJ:    [0.036359641,0.081045533,0.096837977,0.128277388,0.116808183,0.107421427,0.0966687,0.078328931,0.04758019,0,0,0,0,0,0,0,0],
            NM:    [0.025094131,0.066785657,0.07776295,0.107719171,0.094325913,0.081339175,0.071384425,0.052422558,0.026158147,0,0,0,0,0,0,0,0],
            NY:    [0.040442011,0.081275612,0.095832386,0.125303765,0.106969799,0.095093603,0.081473721,0.066439585,0.036248824,0,0,0,0,0,0,0,0],
            NC:    [0.024955202,0.067986235,0.082866947,0.108703396,0.092226614,0.080142063,0.075674392,0.057803604,0.033764036,0,0,0,0,0,0,0,0],
            ND:    [0.029098442,0.061866126,0.074191002,0.101779644,0.084038694,0.071888412,0.079928154,0.057676686,0.03015797,0,0,0,0,0,0,0,0],
            OH:    [0.02684524,0.068408143,0.083602118,0.109947279,0.095536143,0.081814948,0.072272224,0.052721415,0.030857956,0,0,0,0,0,0,0,0],
            OK:    [0.022985785,0.062835669,0.077623053,0.10040895,0.084979474,0.073461562,0.068393949,0.050314465,0.029335004,0,0,0,0,0,0,0,0],
            OR:    [0.038931148,0.089192247,0.102532774,0.12991107,0.107414483,0.096213165,0.073680513,0.054557731,0.035464804,0,0,0,0,0,0,0,0],
            PA:    [0.030007525,0.066032138,0.080850317,0.103306778,0.090679504,0.078135792,0.068722106,0.051194223,0.03294125,0,0,0,0,0,0,0,0],
            RI:    [0.036799882,0.078007317,0.094614383,0.118010906,0.109607951,0.088058706,0.083160083,0.063032706,0.034316677,0,0,0,0,0,0,0,0],
            SC:    [0.019581223,0.054928554,0.0707504,0.093926425,0.07964195,0.070641977,0.068240394,0.04742119,0.028547941,0,0,0,0,0,0,0,0],
            SD:    [0.031784676,0.079913272,0.087702322,0.111184866,0.096139288,0.075126263,0.062229905,0.04743833,0.022857143,0,0,0,0,0,0,0,0],
            TN:    [0.019526725,0.05726879,0.072922445,0.096760922,0.083025311,0.070985552,0.069605794,0.049298504,0.029568711,0,0,0,0,0,0,0,0],
            TX:    [0.023864418,0.065018975,0.07953776,0.113512752,0.100734351,0.089529714,0.084661308,0.065336626,0.037505811,0,0,0,0,0,0,0,0],
            UT:    [0.030149536,0.072925986,0.092181481,0.119555889,0.108232619,0.093176127,0.090092506,0.056228036,0.036635871,0,0,0,0,0,0,0,0],
            VT:    [0.047164765,0.086886043,0.104168559,0.129233805,0.104086494,0.079182631,0.061471861,0.041712006,0.020486556,0,0,0,0,0,0,0,0],
            VA:    [0.026343117,0.07014954,0.092829478,0.127171216,0.115144943,0.104756726,0.099793853,0.080409392,0.046356525,0,0,0,0,0,0,0,0],
            WA:    [0.035233919,0.082512238,0.097920444,0.13302357,0.115595897,0.104145316,0.094802892,0.068856473,0.037419355,0,0,0,0,0,0,0,0],
            DC:    [0.030752429,0.084131271,0.110579424,0.166314008,0.151240035,0.128215121,0.117647059,0.113272311,0.060220994,0,0,0,0,0,0,0,0],
            WV:    [0.029271231,0.066550349,0.089291521,0.107181856,0.097560976,0.081452249,0.077042629,0.047961631,0.041319181,0,0,0,0,0,0,0,0],
            WI:    [0.028563796,0.076806976,0.092881431,0.119068437,0.103847423,0.09082218,0.073485673,0.055587859,0.036749482,0,0,0,0,0,0,0,0],
            WY:    [0.033593608,0.080980288,0.097929936,0.136274684,0.120309259,0.113461538,0.083124478,0.051061212,0.034129693,0,0,0,0,0,0,0,0]
                        }

        var us = {"type":"Topology","transform":{"scale":[0.010489463952493496,0.005238365464986435],"translate":[-171.85342131974025,18.921329380610146]},"objects":{"usStates":{"type":"GeometryCollection","geometries":[{"type":"MultiPolygon","arcs":[[[0]],[[1]]],"properties":{"STATE_ABBR":"HI"}},{"type":"Polygon","arcs":[[2,3,4]],"properties":{"STATE_ABBR":"WA"}},{"type":"Polygon","arcs":[[5,6,7,8,9]],"properties":{"STATE_ABBR":"MT"}},{"type":"Polygon","arcs":[[10,11]],"properties":{"STATE_ABBR":"ME"}},{"type":"Polygon","arcs":[[-10,12,13,14]],"properties":{"STATE_ABBR":"ND"}},{"type":"Polygon","arcs":[[-6,-15,15,16,17,18]],"properties":{"STATE_ABBR":"SD"}},{"type":"Polygon","arcs":[[19,20,-7,-19,21,22]],"properties":{"STATE_ABBR":"WY"}},{"type":"MultiPolygon","arcs":[[[23,24,25,26,27,28]],[[29]]],"properties":{"STATE_ABBR":"WI"}},{"type":"Polygon","arcs":[[-5,30,-8,-21,31,32,33]],"properties":{"STATE_ABBR":"ID"}},{"type":"Polygon","arcs":[[34,35,36,37]],"properties":{"STATE_ABBR":"VT"}},{"type":"Polygon","arcs":[[-16,-14,38,-25,39]],"properties":{"STATE_ABBR":"MN"}},{"type":"Polygon","arcs":[[-34,40,41,42,-3]],"properties":{"STATE_ABBR":"OR"}},{"type":"Polygon","arcs":[[-37,43,-12,44,45]],"properties":{"STATE_ABBR":"NH"}},{"type":"Polygon","arcs":[[46,47,-17,-40,-24,48]],"properties":{"STATE_ABBR":"IA"}},{"type":"Polygon","arcs":[[49,-38,-46,50,51,52]],"properties":{"STATE_ABBR":"MA"}},{"type":"Polygon","arcs":[[53,-22,-18,-48,54,55]],"properties":{"STATE_ABBR":"NE"}},{"type":"Polygon","arcs":[[-50,56,57,58,59,60,-35]],"properties":{"STATE_ABBR":"NY"}},{"type":"Polygon","arcs":[[61,62,63,-60,64,65,66]],"properties":{"STATE_ABBR":"PA"}},{"type":"Polygon","arcs":[[-53,67,68,-57]],"properties":{"STATE_ABBR":"CT"}},{"type":"Polygon","arcs":[[-52,69,-68]],"properties":{"STATE_ABBR":"RI"}},{"type":"Polygon","arcs":[[-65,-59,70,71]],"properties":{"STATE_ABBR":"NJ"}},{"type":"Polygon","arcs":[[72,73,74,75,76]],"properties":{"STATE_ABBR":"IN"}},{"type":"Polygon","arcs":[[-33,77,78,79,-41]],"properties":{"STATE_ABBR":"NV"}},{"type":"Polygon","arcs":[[-32,-20,80,81,-78]],"properties":{"STATE_ABBR":"UT"}},{"type":"Polygon","arcs":[[-80,82,83,-42]],"properties":{"STATE_ABBR":"CA"}},{"type":"Polygon","arcs":[[84,85,-63,86,87,-76]],"properties":{"STATE_ABBR":"OH"}},{"type":"Polygon","arcs":[[88,-49,-29,89,-73,90]],"properties":{"STATE_ABBR":"IL"}},{"properties":{"STATE_ABBR":"DC"}},{"type":"Polygon","arcs":[[-66,-72,91,92]],"properties":{"STATE_ABBR":"DE"}},{"type":"Polygon","arcs":[[93,-87,-62,94,95]],"properties":{"STATE_ABBR":"WV"}},{"type":"Polygon","arcs":[[96,97,-95,-67,-93]],"properties":{"STATE_ABBR":"MD"}},{"type":"Polygon","arcs":[[98,-81,-23,-54,99,100]],"properties":{"STATE_ABBR":"CO"}},{"type":"Polygon","arcs":[[101,-91,-77,-88,-94,102,103]],"properties":{"STATE_ABBR":"KY"}},{"type":"Polygon","arcs":[[-56,104,105,-100]],"properties":{"STATE_ABBR":"KS"}},{"type":"Polygon","arcs":[[-103,-96,-98,106,107,108]],"properties":{"STATE_ABBR":"VA"}},{"type":"Polygon","arcs":[[109,110,111,-105,-55,-47,-89,-102]],"properties":{"STATE_ABBR":"MO"}},{"type":"Polygon","arcs":[[-79,-82,112,113,-83]],"properties":{"STATE_ABBR":"AZ"}},{"type":"Polygon","arcs":[[114,115,-101,-106,-112,116]],"properties":{"STATE_ABBR":"OK"}},{"type":"Polygon","arcs":[[117,-108,118,119,120]],"properties":{"STATE_ABBR":"NC"}},{"type":"Polygon","arcs":[[121,122,123,124,-110,-104,-109,-118]],"properties":{"STATE_ABBR":"TN"}},{"type":"Polygon","arcs":[[-115,125,126,127,128]],"properties":{"STATE_ABBR":"TX"}},{"type":"Polygon","arcs":[[-99,-116,-129,129,-113]],"properties":{"STATE_ABBR":"NM"}},{"type":"Polygon","arcs":[[130,131,132,-123,133]],"properties":{"STATE_ABBR":"AL"}},{"type":"Polygon","arcs":[[134,135,136,-124,-133]],"properties":{"STATE_ABBR":"MS"}},{"type":"Polygon","arcs":[[-122,-121,137,138,139,-134]],"properties":{"STATE_ABBR":"GA"}},{"type":"Polygon","arcs":[[-120,140,-138]],"properties":{"STATE_ABBR":"SC"}},{"type":"Polygon","arcs":[[-111,-125,-137,141,-126,-117]],"properties":{"STATE_ABBR":"AR"}},{"type":"Polygon","arcs":[[-142,-136,142,-127]],"properties":{"STATE_ABBR":"LA"}},{"type":"Polygon","arcs":[[-140,143,-131]],"properties":{"STATE_ABBR":"FL"}},{"type":"MultiPolygon","arcs":[[[144]],[[145,-27]],[[-75,146,-85]]],"properties":{"STATE_ABBR":"MI"}},{"type":"MultiPolygon","arcs":[[[147]],[[148]],[[149]],[[150]],[[151]],[[152]],[[153]],[[154]],[[155]],[[156]],[[157]],[[158]],[[159]],[[160]],[[161]]],"properties":{"STATE_ABBR":"AK"}}]}},"arcs":[[[1352,454],[-41,-2],[-16,57],[27,21],[30,-76]],[[1543,0],[-18,17],[-18,147],[18,94],[63,-53],[39,-87],[-70,-80],[-14,-38]],[[5237,5168],[-197,1],[-139,-59],[-70,-17],[-60,19],[-42,-29],[-49,19],[-13,82],[-39,13]],[[4628,5197],[-55,18],[-1,96],[-46,171],[-22,45],[-10,96],[69,-42],[110,-5],[24,-152],[25,2],[-7,82],[17,45],[-46,93],[20,27],[-26,69],[546,0]],[[5226,5742],[0,-491],[11,-83]],[[6464,5158],[-1,-180]],[[6463,4978],[-667,0],[0,-100]],[[5796,4878],[-25,48],[-24,-33],[-63,1],[-13,-21],[-61,-2],[-32,65],[-63,174],[-31,-44],[-22,58],[21,170],[-54,28],[-80,140],[-29,85],[-1,195]],[[5319,5742],[1144,0]],[[6463,5742],[1,-584]],[[9606,5036],[28,24],[52,90],[-5,32],[31,119],[71,146],[32,-52],[64,32],[42,-55],[-1,-264],[34,-17],[-4,-59],[30,-24],[19,-62],[-80,-53],[-20,-32],[-39,15],[-13,-39],[-38,33],[-11,-69],[-30,-9],[-38,-51],[-35,6],[-6,-40],[-57,-87]],[[9632,4620],[-14,47],[-12,369]],[[6463,5742],[651,0]],[[7114,5742],[13,-62],[-4,-97],[27,-108],[6,-186],[21,-132]],[[7177,5157],[-713,1]],[[7177,5157],[-26,-67],[37,-59],[-1,-339]],[[7187,4692],[0,-81],[-16,-57],[19,-55]],[[7190,4499],[-91,72],[-55,-18],[-51,42],[-530,2]],[[6463,4597],[0,381]],[[5987,4214],[-191,0],[1,191]],[[5797,4405],[-1,473]],[[6463,4597],[1,-382]],[[6464,4215],[-477,-1]],[[7743,4503],[-41,45],[-15,144]],[[7687,4692],[-15,85],[-57,80],[-79,73],[6,105],[-13,54],[20,64],[36,30],[0,112]],[[7585,5295],[35,4],[101,52],[13,-58],[31,-15]],[[7765,5278],[28,-44],[192,-80],[30,-45],[-8,-60],[18,-44]],[[8025,5005],[6,-58],[28,-8],[-19,-118],[-20,-54],[-14,-102],[7,-166]],[[8013,4499],[-270,4]],[[8086,5034],[-26,-94],[-9,21],[35,73]],[[5226,5742],[93,0]],[[5797,4405],[-285,0]],[[5512,4405],[-284,0]],[[5228,4405],[-2,344],[13,66],[-31,63],[37,85],[34,124],[-42,81]],[[9399,4548],[2,146],[-17,23],[11,120],[-4,143]],[[9391,4980],[176,1]],[[9567,4981],[-17,-113],[-36,-31],[2,-34],[-32,-97],[-8,-162]],[[9476,4544],[-77,4]],[[7114,5742],[198,0],[0,71],[31,-8],[25,-118],[69,-17],[6,-21],[79,22],[43,-36],[12,-42],[32,26],[45,-60],[67,41],[11,-32],[58,5],[13,-55],[-48,-22],[-170,-201]],[[7687,4692],[-500,0]],[[5228,4405],[-284,-1]],[[4944,4404],[-402,1]],[[4542,4405],[-14,19],[-4,101],[-15,40],[38,195],[19,274],[-2,174],[64,-11]],[[9567,4981],[39,55]],[[9632,4620],[0,-49]],[[9632,4571],[-45,-32],[-111,5]],[[7665,4095],[-28,45],[-238,-7],[-145,3]],[[7254,4136],[-16,167],[-48,196]],[[7743,4503],[45,-78],[-18,-98],[-67,-35],[9,-87],[-47,-110]],[[9378,4415],[21,133]],[[9632,4571],[8,-39],[-29,-72],[25,-7],[23,-84],[-55,-60],[-8,35],[-3,6]],[[9593,4350],[-14,58],[-40,-1]],[[9539,4407],[-161,8]],[[6655,4024],[0,190],[-191,1]],[[7254,4136],[43,-112]],[[7297,4024],[-642,0]],[[9378,4415],[-4,-100],[5,-60],[-17,-41]],[[9362,4214],[-34,-56]],[[9328,4158],[11,56],[-77,68]],[[9262,4282],[-26,25],[-10,63],[-25,34],[-422,2],[0,51]],[[8779,4457],[87,100],[-20,91],[57,19],[85,-24],[63,7],[66,52],[9,72],[-23,32],[99,136],[57,35],[132,3]],[[8806,3970],[-99,1],[0,174]],[[8707,4145],[0,258]],[[8707,4403],[72,54]],[[9262,4282],[-42,-74],[-4,-78],[42,-72],[-65,-72]],[[9193,3986],[-35,-15]],[[9158,3971],[-352,-1]],[[9539,4407],[0,-78],[-7,-53]],[[9532,4276],[-99,-10],[-71,-52]],[[9593,4350],[-25,-60],[-36,-14]],[[9328,4158],[-26,-36],[29,-36],[-19,-116],[-67,-145],[-64,102],[6,42]],[[9187,3969],[6,17]],[[7991,3605],[4,82],[46,107],[-16,67],[13,39],[1,453]],[[8039,4353],[28,-19],[38,27]],[[8105,4361],[195,-1],[0,-12]],[[8300,4348],[-2,-496]],[[8298,3852],[-1,-59],[-60,-18],[3,-26],[-40,-54],[-20,-59],[-24,35],[-21,-40],[-33,9],[-25,-38],[-25,28],[-61,-25]],[[5512,4405],[-1,-737],[0,-217]],[[5511,3451],[1,-149],[-9,-34],[-56,13],[9,-212]],[[5456,3069],[-120,191],[-242,360],[-150,212],[0,572]],[[5987,4214],[0,-763]],[[5987,3451],[-476,0]],[[5456,3069],[23,-103],[24,-27],[-37,-67],[-1,-78],[-19,-28],[20,-73],[-19,-59]],[[5447,2634],[-230,-35],[-27,133],[-66,98],[-29,-2],[-13,57],[-37,1],[-64,72],[-81,5],[-18,25],[1,108],[-61,100],[-65,176],[18,45],[-39,34],[-31,100],[29,41],[-19,81],[-50,-25],[-7,51],[-69,120],[-11,172],[-49,81],[-4,35],[27,104],[4,91],[-14,103]],[[8300,4348],[125,5]],[[8425,4353],[89,-63],[77,18],[36,45],[80,50]],[[8707,4145],[-34,-193],[-56,-41],[-55,-75],[-27,-110],[-25,-5]],[[8510,3721],[-27,58],[-40,-23],[-89,41],[-21,57],[-35,-2]],[[7886,3449],[-36,55],[-1,80],[-80,103],[23,108],[-48,15],[-11,70],[-60,91],[-8,124]],[[8013,4499],[-3,-33],[29,-113]],[[7991,3605],[-5,-63],[-36,-14],[-1,-63],[-50,28],[-13,-44]],[[9187,3969],[-10,-47],[18,-75],[31,-52],[3,-67],[-2,0],[-2,0]],[[9225,3728],[-58,3],[-1,35],[-8,205]],[[8570,3553],[-32,26],[-34,91],[6,51]],[[8806,3970],[-1,-99],[70,73],[27,-12],[28,34],[43,-72]],[[8973,3894],[-9,-36],[-50,62],[-5,-55],[-44,-77],[-12,16],[-31,-83],[-31,34],[-58,-190],[-93,-68],[-59,9],[-11,47]],[[9225,3728],[-27,-83],[-26,-9],[-62,89],[9,63],[-33,-1],[15,-70],[-18,-32],[-61,32],[8,49]],[[9030,3766],[9,27],[-8,27],[-58,74]],[[6564,3451],[-577,0]],[[6655,4024],[1,-575]],[[6656,3449],[-92,2]],[[7859,3356],[20,15],[10,72],[-3,6]],[[8570,3553],[-73,-81],[-39,-70],[-52,-28]],[[8406,3374],[-270,11],[-128,-2],[-18,-28],[-131,1]],[[7297,4024],[40,-35],[-21,-49],[49,-80],[-2,-409]],[[7363,3451],[-707,-2]],[[9030,3766],[-19,-41],[102,-104],[-19,-121],[17,-56],[28,-7],[11,-71],[-3,0],[-9,1],[-3,0],[-1,0]],[[9134,3367],[-419,-2],[-117,8]],[[8598,3373],[-192,1]],[[7859,3356],[-6,-1],[-5,0],[-18,-95]],[[7830,3260],[-41,94],[-426,0]],[[7363,3354],[0,97]],[[5987,3451],[0,-870],[1,-209]],[[5988,2372],[-193,-2],[-358,220],[10,44]],[[7377,2808],[-73,64],[-66,-14],[-40,-36],[-61,46],[-9,-39],[-56,47],[-17,-25],[-23,53],[-34,-15],[-70,30],[-17,46],[-31,-14],[-30,35],[0,368],[-286,0]],[[6564,3354],[0,97]],[[7363,3354],[18,-208],[-3,-230],[-1,-108]],[[8345,3067],[3,43],[32,46],[92,61],[7,29],[85,39],[34,88]],[[9134,3367],[-16,-111],[44,-21],[-41,-100],[-43,18],[-4,-89],[-83,-98],[-47,-104],[-52,-6]],[[8892,2856],[-104,175],[-107,3],[-24,64],[-117,9],[-79,-37]],[[8461,3070],[-116,-3]],[[8345,3067],[-123,1]],[[8222,3068],[-246,2]],[[7976,3070],[-202,0]],[[7774,3070],[23,27],[-6,50],[39,113]],[[7377,2808],[42,-14],[-1,-102]],[[7418,2692],[1,-196],[50,-183],[-22,-94],[3,-58],[-5,-45]],[[7445,2116],[-29,-63],[-48,-19],[-16,41],[-27,-44],[12,-31],[-61,-114],[-67,-44],[-68,-87],[-59,-217],[30,-174],[-17,-42],[-21,34],[-52,6],[-87,69],[-33,117],[-9,111],[-31,36],[-40,92],[-36,152],[-76,136],[-82,17],[-33,-26],[-46,-146],[-85,67],[-46,67],[-34,170],[-48,54],[-109,178]],[[6227,2456],[-8,41],[340,0],[5,857]],[[6227,2456],[-159,0],[-1,-84],[-79,0]],[[8280,2306],[-248,0],[18,-99]],[[8050,2207],[-17,-39],[-30,27],[-47,-5]],[[7956,2190],[-5,199],[-2,87],[36,573],[-9,21]],[[8222,3068],[41,-405],[27,-115],[-22,-94],[12,-148]],[[7956,2190],[-46,1],[-66,-39]],[[7844,2152],[-26,92],[11,63],[-181,-1],[13,124],[49,109],[-17,151]],[[7693,2690],[1,145],[47,113],[33,122]],[[8461,3070],[-23,-62],[42,-38],[31,-99],[63,-97],[15,-49],[22,-29],[40,-179]],[[8651,2517],[20,-19],[-60,-167],[0,-78]],[[8611,2253],[-46,13],[-20,-43],[-252,28],[-13,55]],[[8892,2856],[-95,-165],[-30,-65],[-116,-109]],[[7693,2690],[-275,2]],[[7844,2152],[-63,36],[-15,-56],[57,3],[2,-94],[55,-50],[4,-56],[-77,79],[-27,-41],[-20,18],[-44,-32],[-67,112],[-65,-44],[-89,48],[-46,-6],[-4,47]],[[8611,2253],[20,-171],[51,-199],[4,-74],[32,-133],[34,-172],[-7,-157],[-28,-150],[-67,-11],[-13,128],[-44,23],[-36,190],[-19,-13],[-37,119],[27,82],[-36,51],[13,136],[-38,56],[-59,140],[-30,32],[-36,-2],[-48,-61],[-43,-9],[-8,42],[-101,110],[-92,-3]],[[7947,5584],[-62,-66],[-1,22],[63,44]],[[7765,5278],[58,49],[39,5],[72,71],[17,-81],[25,19],[50,-12],[28,-63],[70,-16],[47,48],[107,4],[1,-42],[67,2],[38,-100],[-74,14],[-4,-34],[-75,47],[-13,-25],[-58,-5],[-35,-62],[-13,39],[-34,-25],[-53,-106]],[[8105,4361],[53,125],[1,134],[-26,103],[2,75],[24,56],[19,105],[40,11],[53,79],[12,70],[23,8],[59,-53],[59,-27],[20,-125],[-7,-70],[-54,-80],[21,-61],[36,65],[36,25],[31,-54],[19,-156],[-9,-64],[-20,9],[-72,-183]],[[1003,7600],[-41,-35],[-3,80],[-25,58],[33,43],[-71,132],[-5,-36],[-82,-35],[-71,3],[-53,81],[-72,57],[56,59],[-73,47],[-26,41],[16,150],[59,80],[28,15],[-8,43],[27,57],[43,24],[76,-45],[27,7],[75,82],[11,-12],[96,16],[35,44],[-17,95],[-27,29],[44,62],[-39,42],[-17,-28],[-71,-14],[-63,-72],[-75,43],[-76,3],[-64,-26],[-115,29],[-14,57],[-30,19],[7,71],[-79,10],[-58,31],[68,59],[140,64],[11,18],[100,44],[75,11],[17,-17],[-16,-59],[25,-26],[86,7],[9,-21],[79,3],[29,48],[42,-5],[25,27],[57,3],[-9,39],[-78,9],[-35,-22],[-37,37],[3,62],[-56,-12],[-121,23],[-28,83],[-128,94],[-89,49],[6,111],[181,11],[73,40],[42,46],[15,75],[97,101],[93,4],[124,90],[94,-2],[77,13],[101,85],[112,-22],[6,-66],[28,47],[65,-13],[39,-46],[27,22],[66,7],[75,-11],[-6,-43],[72,-16],[50,-36],[42,25],[122,4],[122,-32],[50,-28],[177,-8],[83,-38],[161,28],[65,-21],[31,-30],[84,-40],[37,1],[1,-1783],[52,1],[44,-23],[29,29],[58,2],[-11,-50],[152,-162],[12,-64],[84,49],[23,84],[83,38],[44,-45],[6,-55],[47,-29],[20,-51],[78,-76],[149,-317],[77,-77],[92,-53],[-8,-70],[18,-90],[-35,-71],[-54,-19],[3,171],[-30,51],[-70,-1],[-3,74],[-87,126],[-64,31],[12,32],[-25,84],[-46,79],[-56,35],[-18,83],[-20,-35],[7,-77],[-72,46],[-24,74],[-12,-21],[18,-70],[-62,-16],[-90,57],[-32,59],[-179,120],[35,33],[-14,34],[-75,-36],[-221,79],[-111,-23],[-77,55],[-12,60],[-38,-43],[-69,19],[9,44],[-74,23],[-7,30],[-111,-27],[-32,-40],[25,-31],[-68,-103],[-62,18],[-84,-93],[-147,-70],[-24,21],[24,143],[28,35],[15,64],[-13,36],[92,57],[37,-23],[-1,47],[-50,25],[-110,-70],[-84,-133],[-8,-57],[-49,-53],[-22,28],[-28,-68],[-38,-11],[10,-57],[58,-18],[-17,-67],[-47,-29],[-22,-77],[-67,-11],[-26,-55],[-28,11],[-13,-46],[-28,5],[-49,-50],[4,-51],[-26,0],[-67,-82],[-29,12],[-9,-41],[-52,-4],[-2,-86],[-133,-27],[-79,-75],[-55,-21],[-43,11],[-50,-73],[-36,26],[-13,-41],[-43,37],[65,58],[69,85],[56,23],[60,-15],[19,65],[50,51],[109,84],[39,66],[58,46],[12,158],[46,71],[-4,21],[-104,-51],[-50,51],[2,-73],[-33,-13],[-36,68],[-46,-2],[-39,55],[-96,-62]],[[547,7920],[41,-22],[7,-75],[-47,-27],[-98,45],[61,73],[36,6]],[[732,6812],[-20,-31],[-45,-4],[-9,31],[44,63],[91,25],[16,-56],[-22,-27],[-55,-1]],[[387,6600],[-47,-49],[-6,45],[53,4]],[[73,8497],[-35,-23],[-38,38],[21,35],[68,-23],[59,23],[20,-40],[87,-36],[-46,-67],[-14,34],[-100,64],[-22,-5]],[[2455,7917],[-48,-30],[2,47],[46,-17]],[[1884,7529],[1,-39],[-66,-16],[11,77],[54,-22]],[[3613,7326],[-39,-42],[-52,215],[70,-9],[27,-69],[-6,-95]],[[3429,7458],[92,-45],[10,-52],[-72,21],[-26,-39],[-37,76],[-4,61],[45,33],[82,-46],[1,-44],[-29,-5],[-62,40]],[[1760,7299],[-29,-56],[-43,-23],[-2,41],[-35,6],[-19,83],[104,89],[41,-20],[-6,42],[90,-37],[-1,-74],[-47,-30],[-31,16],[-22,-37]],[[3546,7109],[-68,128],[-4,61],[-25,37],[34,36],[46,-55],[21,-100],[-4,-107]],[[3699,7265],[11,-67],[-22,-33],[-46,-2],[-21,123],[78,-21]],[[3612,7094],[-30,52],[14,25],[-25,45],[12,41],[52,-32],[-19,-51],[-4,-80]],[[3754,6982],[22,-58],[26,6],[-3,-102],[-76,111],[-40,2],[-15,84],[11,82],[73,-64],[2,-61]],[[3837,6948],[-21,26],[11,53],[45,42],[29,-59],[-20,-85],[-44,23]]]}    

        for (var i = 0; i < data.Name.length; i++) {

            for (var j = 0; j < us.objects.usStates.geometries.length; j++)  {
		        var usStateID = us.objects.usStates.geometries[j].properties.STATE_ABBR;
                if (data.StateID[i] == usStateID) {
                us.objects.usStates.geometries[j].properties.avg = data.Avg[i]; 
                us.objects.usStates.geometries[j].properties.name = data.Name[i];
                us.objects.usStates.geometries[j].properties.bin = "On Average";
                us.objects.usStates.geometries[j].properties.val = data.Avg[i];
                for (var k = 1; k < nums.Bins.length; k++) {
                    if (loan_amt < nums.Bins[0]) {
                        us.objects.usStates.geometries[j].properties.bin = nums.BinNames[0];
                        us.objects.usStates.geometries[j].properties.val = nums[us.objects.usStates.geometries[j].properties.STATE_ABBR][0]
                    }
                    else if (loan_amt > nums.Bins[k-1] && loan_amt <= nums.Bins[k]) {
                        us.objects.usStates.geometries[j].properties.bin = nums.BinNames[k];
                        us.objects.usStates.geometries[j].properties.val = nums[us.objects.usStates.geometries[j].properties.STATE_ABBR][k]
                    }
                }
                break;
                }
            } 
        } 

        var chColorScale = d3.scale.quantile()
                .domain([0,0.02,0.04,0.06,0.08,0.10])
                .range(colorbrewer.Blues[5]);
              
            svg5.selectAll('.states')
                .data(topojson.feature(us, us.objects.usStates).features)
                .enter()
                .append('path')
                .attr('class', 'states')
                .attr('d', path)
                .style('stroke','black')
                .style("fill",function(d){
                    return chColorScale(d.properties.val)
                })
                .on('mouseover', function(d){
                    div.transition()		
                        .duration(200)		
                        .style("opacity", .9);		
                    div.html(d.properties.name + ": " + d3.format(".2f%")(d.properties.val*100)+"%")	
                        .style("left", (d3.event.pageX) + "px")		
                        .style("top", (d3.event.pageY - 28) + "px");	})
                .on('mouseout', function(d){
                    div.transition()		
                        .duration(500)		
                        .style("opacity", 0);	
                    });

            svg5.append("text")
                .attr("class", "subtitle")
                .attr("x",(stats_width+margin)/2-margin-220)
                .attr("y",-125)
                .style("text-anchor","middle")
                .style("text-decoration", "underline") 
                .style("font-size","14px")
                .text("Average Lending Club Approval Rate For Loans " + us.objects.usStates.geometries[2].properties.bin); 
				
			var xlocation=intViewportWidth-200;
            var legend = d3.select("#chloro").append("svg")
      			.attr("class", "legend")
                .attr("transform", "translate("+ xlocation + "," + -450 + ")")
     			.attr("width", 140)
    			.attr("height", 160)
   				.selectAll("g")
   				.data(chColorScale.range().slice(0,9))
   				.enter()
   				.append("g")
     			.attr("transform", function(d, i) { return "translate(0," + (i * 20) + ")"; });

            legend.append("rect")
                .attr("width", 18)
                .attr("height", 18)
                .style("fill", function(d,i) {return chColorScale.range()[i] } );

            var legendText = ["< 2.0%", "2.0 - 3.99%","4.0 - 5.99%","6.0 - 7.99%",">= 8.0%"]

            legend.append("text")
                .data(legendText)
                .attr("x", 24)
                .attr("y", 9)
                .attr("dy", ".35em")
                .attr("font-size","12px")
                .text(function(d) { return d; });

    </script>
</body>
